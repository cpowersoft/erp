Ext.ux.RmaGrid=Ext.extend(Ext.ux.NormalGrid,{initComponent:function(){Ext.ux.RmaGrid.superclass.initComponent.call(this);},createTbar:function(){this.tbar=null;},createColumns:function(){var ds=this.store;var cols=[new Ext.grid.RowNumberer(),{header:'域名',dataIndex:'domain_name',width:128,renderer:Ext.ux.RmaGrid.deal_fld},{header:'操作时间',dataIndex:'addtime'},{header:'操作',width:20,xtype:'actioncolumn',items:[{icon:'themes/default/images/drop-add.gif',tooltip:'增加订单',handler:function(grid,rowIndex,colIndex){var id=ds.getAt(rowIndex).get('blacklist_id');parent.openWindow(id,'新建订单','index.php?model=order&action=add&id='+id,1000,680);}}]}];this.columns=cols;}});Ext.ux.RmaGrid.change_status=function(id,status_num,yds){Ext.Ajax.request({url:'index.php?model=rma&action=changestatus&id='+id+'&status='+status_num,success:function(response){var result=Ext.decode(response.responseText);if(result.success==true){yds.reload();}}});}
Ext.ux.RmaGrid.huanhuo=function(rec,yds){var win,huanhuo_form;huanhuo_form=new Ext.FormPanel({labelWidth:75,url:'index.php?model=rma&action=addHuanhuo',frame:false,bodyStyle:'padding:5 5 5 5',height:250,width:400,defaultType:'textfield',defaults:{width:'60%'},items:[{fieldLabel:'换货单据ID',name:'huanhuo_sn',allowBlank:false},{fieldLabel:'RMA单据ID',name:'huanhuo_rma_sn',value:rec.get('rma_sn'),allowBlank:false},{fieldLabel:'原始订单号',name:'huanhuo_order_sn',value:rec.get('order_sn'),allowBlank:false},{fieldLabel:'新订单号',name:'new_order_sn'},{fieldLabel:'处理时间',xtype:'datefield',name:'deal_time',format:'Y-m-d',invalidText:'格式错误！'},{fieldLabel:'备注',xtype:'textarea',name:'huanhuo_remark'}],buttons:[{text:'提交',handler:function(){Ext.MessageBox.alert('提示','操作成功！',function(){huanhuo_form.getForm().submit({success:function(){Ext.ux.RmaGrid.change_status(rec.get('id'),1);yds.reload();}});win.hide();});}},{text:'重设',handler:function(){huanhuo_form.getForm().reset();}}]});if(!win){win=new Ext.Window({title:'换货单据_添加',layout:'fit',width:500,height:330,closeAction:'hide',plain:true,collapsible:true,items:huanhuo_form});}
win.show();}
Ext.ux.RmaGrid.deal_fld=function(value,metaData,record){if(record.get('remark')!='')
return value+'<img src="themes/default/images/comment.gif" title="'+record.get('remark')+'" style="cursor:pointer"/>';else
return value;}